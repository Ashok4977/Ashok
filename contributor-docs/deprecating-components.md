As we work on the maturity of our components, we will sometimes need to build components in a parallel track/bundle without breaking existing components. Eventually, the new components would replace the old ones in the main bundle and this document explains the process around it.

## Developing a draft component

Start building the new component outside of the main bundle. This includes the source code of the component being under the `src/drafts` folder and the component being exported in the draft bundle (`src/drafts/index.ts`). That way, folks who
who would like to try the draft version of the component can export it from the draft bundle.

```
import { ActionList } from "@primer/react/drafts"
```

If it is a 1:1 replacement, it's useful to keep the component name the same for consumers. Internally, we would want to, for example, call the folder name `ActionList2` and call the docs `ActionMenu v2`.

## Deprecating the component

Once the component is ready to be graduated from the drafts bundle to the main one, we first plan to see in which major release the component will go into deprecation and prepare for the code changes and the communications around it.

### Code side of the deprecation

Here is a checklist for developers to smoothen the deprecation process.

#### Source Code

- [ ] Move the old component's source code under the `src/deprecated` folder.
- [ ] Remove the old component export in the main bundle to be added to the deprecated one.
- [ ] Export the old component in the deprecated bundle `src/deprecated/index.ts`.
- [ ] Rename the new component to its neutral version if it includes `2` or `v2`. I.e. `ActionList2` -> `ActionList`.
- [ ] Move the new component's source code to the `src` folder if it is under `src/drafts`.
- [ ] Export the new component in the main bundle `src/index.ts`.

#### Storybook

- [ ] Update the new component's storybook title from `Drafts/Components/<Component-Name>` to `Components/<Component-Name>`.
- [ ] Move the old component's stories under `src/stories/deprecated`.

#### Tests

- [ ] Move the old component's tests under `src/__tests__/deprecated`.
- [ ] Update `script/generate-e2e-tests.js` to reflect the new component's component ID is generated by the storybook title.
- [ ] Update the snapshots using the command `npm run test -- -u`.

#### Docs

- [ ] Move the deprecated component's docs to the `src/docs/deprecated` folder and update the title by adding `(legacy)`, status as well as the storybook and the source code link.
  - [ ] Make sure to update `jsx live` -> `jsx live deprecated`
  - [ ] Make sure to update the import code block. I.e. `import { ActionList } from "@primer/react/deprecated"`.
- [ ] Add a `Deprecation` section with the link of the newly developed component and provide a diff. See [deprecated ActionList docs](https://primer.style/react/deprecated/ActionList#deprecation) as an example.
- [ ] Move the new components docs from draft folder to the main docs folder `docs/content/` and update the title by removing `v2`, status as well as the storybook and the source code link.
  - [ ] Make sure to update `jsx live drafts` -> `jsx live`
  - [ ] Make sure to update the import code block. I.e. `import { ActionList } from "@primer/react"`.
  - [ ] Update the navigation on `docs/src/@primer/gatsby-theme-doctocat/nav.yml` accordingly.

### Comms side of the deprecation

When we know if the newly developed component is ready to go in the main bundle and the old component is good to be deprecates in the next major release, we announce the deprecation and the promotion in the Primer changelog under the `Coming soon` section.

Once the major release is out, we provide support on how to switch using the newly develop component as well as how to continue to use the deprecated component for folks who prefer to migrate later on.

We also write codemods to deprecate the old component and use the new component under [our migration repo](https://github.com/primer/react-migrate#readme).

### Accessibility Scorecards

As teams begin to adopt the [Accessibility scorecard](https://github.com/github/engineering/discussions/2443), we have an opportunity to encourage teams to update/remove deprecated components and adopt new ones.

To get these items on the scorecard, we should be reaching out to #accessibility:

- When we deprecate a component
- When we release a new component that we want to enforce usage around

## Removing the deprecated component

After about 6 months of living in the deprecated bundle, a component is retired/deleted from the codebase. This is also a breaking change and we release it in the upcoming major release.
At this point, consumers are expected to plan migration work and we annouce the deletion in Primer Changelog as we do for the deprecation.

## FAQ

- Does the deprecated component accept new feature request?
  - No, because we have a single bundle for all components, you can not pick the components you want to upgrade. This can result in additional unrelated work.
