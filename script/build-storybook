#!/bin/bash
set -e

# Add base url to be able to serve static files
if [ -n "$1" ]; then
  echo '<base href="/storybook/" />' >> .storybook/manager-head.html
else
  echo '<base href="/react/storybook/" />' >> .storybook/manager-head.html
fi

# Build storybook inside docs
# STORYBOOK_STATIC_DIR is a workaround for the following issue:
# https://github.com/storybookjs/storybook/issues/21564
#
# It can be replaced by the `-s` flag once this issue is addressed and published
STORYBOOK=true STORYBOOK_STATIC_DIR='docs/public/static' npx storybook build -o docs/public/storybook

# Remove manager-head after build to not interfere with dev builds
rm .storybook/manager-head.html
